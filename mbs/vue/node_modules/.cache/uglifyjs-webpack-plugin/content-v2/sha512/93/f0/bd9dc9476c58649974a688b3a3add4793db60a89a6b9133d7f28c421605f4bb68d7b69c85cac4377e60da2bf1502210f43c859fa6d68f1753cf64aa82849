{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-04b9\"],{L4vI:function(t,e,i){\"use strict\";i.r(e);var a=i(\"FyfS\"),n=i.n(a),s=i(\"P2sY\"),l=i.n(s),o=i(\"14Xm\"),r=i.n(o),u=i(\"D3Ub\"),c=i.n(u),d=i(\"t3Un\");var p=i(\"4d7F\"),f=i.n(p),m=function(t,e){var i={\"M+\":t.getMonth()+1,\"d+\":t.getDate(),\"h+\":t.getHours(),\"m+\":t.getMinutes(),\"s+\":t.getSeconds(),\"q+\":Math.floor((t.getMonth()+3)/3),\"S+\":t.getMilliseconds()};for(var a in/(y+)/i.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+\"\").substr(4-RegExp.$1.length))),i)new RegExp(\"(\"+a+\")\").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?i[a]:(\"00\"+i[a]).substr((\"\"+i[a]).length)));return e},h=i(\"mxV5\"),v={randomString:function(t){for(var e=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\",\"s\",\"t\",\"u\",\"v\",\"w\",\"x\",\"y\",\"z\"],i=\"\",a=0;a<t;a++){i+=e[Math.ceil(35*Math.random())]}return i},createOssClient:function(){return new f.a(function(t,e){t(new h({region:\"oss-cn-shenzhen\",accessKeyId:\"LTAIOtDpx624KII9\",accessKeySecret:\"pEBhGwMNooo1aDJwbz7ZzNopffkk0B\",bucket:\"1set-oss\"}))})},ossUploadFile:function(t){var e=t.file,i=this;return new f.a(function(a,n){var s=\"file/\"+m(new Date,\"yyyyMMdd\")+\"/\"+m(new Date,\"yyyyMMddhhmmss\")+\"_\"+i.randomString(4)+e.name.substr(e.name.indexOf(\".\"));i.createOssClient().then(function(i){a({fileName:e.name,fileUrl:s}),i.multipartUpload(s,e,{progress:function(e){var i={};i.percent=Math.floor(100*e),t.onProgress(i)}}).then(function(e){if(200===e.res.statusCode)return t.onSuccess(e),e;t.onError(\"上传失败\")},function(e){t.onError(\"上传失败\"),n(e)})})})}},b=i(\"ZySA\"),g=i(\"7Qib\"),y={name:\"HomeBanner\",components:{Pagination:i(\"Mz3J\").a},directives:{waves:b.a},filters:{statusFilter:function(t){return{published:\"success\",hidden:\"danger\"}[t]}},data:function(){return{tableKey:0,list:null,listLoading:!0,uploadUrl:\"\",listQuery:{title:void 0},deleteQuery:{id:void 0},importanceOptions:[1,2],statusOptions:[\"published\",\"hidden\"],showReviewer:!1,temp:{id:void 0,no:1,timestamp:new Date,title:\"\",status:\"published\",image:\"\"},dialogFormVisible:!1,dialogStatus:\"\",textMap:{update:\"Edit\",create:\"Create\"},dialogPvVisible:!1,pvData:[],rules:{type:[{required:!0,message:\"type is required\",trigger:\"change\"}],timestamp:[{type:\"date\",required:!0,message:\"timestamp is required\",trigger:\"change\"}],title:[{required:!0,message:\"title is required\",trigger:\"blur\"}]},downloadLoading:!1}},created:function(){this.getList()},methods:{fnUploadRequest:function(t){var e=this;return c()(r.a.mark(function i(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:v.ossUploadFile(t);case 1:case\"end\":return e.stop()}},i,e)}))()},beforeUpload:function(t){},handleSuccess:function(t,e,i){var a=t.res.requestUrls[0],n=a.indexOf(\"?\");if(n>0)var s=a.substring(0,n);else s=a;this.temp.image=s},beyondFile:function(t,e){},getList:function(){var t=this;this.listLoading=!0,function(t){return Object(d.a)({url:\"/banner/list\",method:\"get\",params:t})}(this.listQuery).then(function(e){t.list=e.data.items,setTimeout(function(){t.listLoading=!1},1500)})},handleFilter:function(){this.getList()},handleModifyStatus:function(t,e){var i=this,a={},n=t.id;a.id=n,a.status=e,this.listLoading=!0,function(t){return Object(d.a)({url:\"/banner/modify_status\",method:\"post\",data:t})}(a).then(function(a){i.listLoading=!1,200==a.data.success_code?(i.$notify({title:\"成功\",message:\"操作成功\",type:\"success\",duration:2e3}),t.status=e):i.$notify({title:\"失败\",message:\"删除失败\",type:\"info\",duration:2e3})})},sortChange:function(t){var e=t.prop,i=t.order;\"id\"===e&&this.sortByID(i)},sortByID:function(t){this.listQuery.sort=\"ascending\"===t?\"+id\":\"-id\",this.handleFilter()},resetTemp:function(){this.temp={id:void 0,no:1,timestamp:new Date,title:\"\",status:\"published\",image:\"\"}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus=\"create\",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate(),t.$refs.upload.clearFiles()})},createData:function(){var t=this;this.$refs.dataForm.validate(function(e){e&&(t.temp.url=t.temp.image,function(t){return Object(d.a)({url:\"/banner/create\",method:\"post\",data:t})}(t.temp).then(function(e){200==e.data.success_code?(t.temp.id=e.data.id,t.list.unshift(t.temp),t.dialogFormVisible=!1,t.$notify({title:\"成功\",message:\"创建成功\",type:\"success\",duration:2e3})):t.$notify({title:\"失败\",message:\"创建失败\",type:\"fail\",duration:2e3})}))})},handleUpdate:function(t){var e=this;this.temp=l()({},t),this.temp.timestamp=new Date(this.temp.timestamp),this.dialogStatus=\"update\",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate(),e.$refs.upload.clearFiles()})},updateData:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){t.temp.url=t.temp.image;var i=l()({},t.temp);i.timestamp=+new Date,function(t){return Object(d.a)({url:\"/banner/update\",method:\"post\",data:t})}(i).then(function(){var e=!0,i=!1,a=void 0;try{for(var s,l=n()(t.list);!(e=(s=l.next()).done);e=!0){var o=s.value;if(o.id===t.temp.id){var r=t.list.indexOf(o);t.list.splice(r,1,t.temp);break}}}catch(t){i=!0,a=t}finally{try{!e&&l.return&&l.return()}finally{if(i)throw a}}t.dialogFormVisible=!1,t.$notify({title:\"成功\",message:\"更新成功\",type:\"success\",duration:2e3})})}})},handleDelete:function(t){var e=this;this.$confirm(\"此操作将永久删除该文件, 是否继续?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){var i={},a=t.id;i.id=a,function(t){return Object(d.a)({url:\"/banner/delete\",method:\"post\",data:t})}(i).then(function(i){if(200==i.data.success_code){e.$notify({title:\"成功\",message:\"删除成功\",type:\"success\",duration:2e3});var a=e.list.indexOf(t);e.list.splice(a,1)}else e.$notify({title:\"失败\",message:\"删除失败\",type:\"info\",duration:2e3})})}).catch(function(){e.$message({type:\"info\",message:\"已取消删除\"})})},handleFetchPv:function(t){var e=this;fetchPv(t).then(function(t){e.pvData=t.data.pvData,e.dialogPvVisible=!0})},handleDownload:function(){var t=this;this.downloadLoading=!0,Promise.all([i.e(\"chunk-7a57\"),i.e(\"chunk-3c5e\"),i.e(\"chunk-bfbc\")]).then(i.bind(null,\"S/jZ\")).then(function(e){var i=t.formatJson([\"timestamp\",\"title\",\"type\",\"importance\",\"status\"],t.list);e.export_json_to_excel({header:[\"timestamp\",\"title\",\"type\",\"importance\",\"status\"],data:i,filename:\"table-list\"}),t.downloadLoading=!1})},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){return\"timestamp\"===t?Object(g.e)(e[t]):e[t]})})}}},w=i(\"KHd+\"),_=Object(w.a)(y,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(\"div\",{staticClass:\"app-container\"},[i(\"div\",{staticClass:\"filter-container\"},[i(\"el-input\",{staticClass:\"filter-item\",staticStyle:{width:\"200px\"},attrs:{placeholder:t.$t(\"table.title\")},nativeOn:{keyup:function(e){return\"button\"in e||!t._k(e.keyCode,\"enter\",13,e.key,\"Enter\")?t.handleFilter(e):null}},model:{value:t.listQuery.title,callback:function(e){t.$set(t.listQuery,\"title\",e)},expression:\"listQuery.title\"}}),t._v(\" \"),i(\"el-button\",{directives:[{name:\"waves\",rawName:\"v-waves\"}],staticClass:\"filter-item\",attrs:{type:\"primary\",icon:\"el-icon-search\"},on:{click:t.handleFilter}},[t._v(t._s(t.$t(\"table.search\")))]),t._v(\" \"),i(\"el-button\",{staticClass:\"filter-item\",staticStyle:{\"margin-left\":\"10px\"},attrs:{type:\"primary\",icon:\"el-icon-edit\"},on:{click:t.handleCreate}},[t._v(t._s(t.$t(\"table.add\")))]),t._v(\" \"),i(\"el-button\",{directives:[{name:\"waves\",rawName:\"v-waves\"}],staticClass:\"filter-item\",attrs:{loading:t.downloadLoading,type:\"primary\",icon:\"el-icon-download\"},on:{click:t.handleDownload}},[t._v(t._s(t.$t(\"table.export\")))])],1),t._v(\" \"),i(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.listLoading,expression:\"listLoading\"}],key:t.tableKey,staticStyle:{width:\"100%\"},attrs:{data:t.list,border:\"\",fit:\"\",\"highlight-current-row\":\"\"},on:{\"sort-change\":t.sortChange}},[i(\"el-table-column\",{attrs:{label:t.$t(\"table.id\"),prop:\"id\",sortable:\"custom\",align:\"center\",width:\"65\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"span\",[t._v(t._s(e.row.id))])]}}])}),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.date\"),width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"span\",[t._v(t._s(t._f(\"parseTime\")(e.row.timestamp,\"{y}-{m}-{d} {h}:{i}\")))])]}}])}),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.title\"),\"min-width\":\"80px\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"span\",{staticClass:\"link-type\",on:{click:function(i){t.handleUpdate(e.row)}}},[t._v(t._s(e.row.title))])]}}])}),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.img\"),width:\"150px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(t){return[i(\"img\",{staticStyle:{width:\"150px\",height:\"70px\"},attrs:{src:t.row.image,fit:\"contain\"}})]}}])}),t._v(\" \"),t.showReviewer?i(\"el-table-column\",{attrs:{label:t.$t(\"table.reviewer\"),width:\"110px\",align:\"center\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"span\",{staticStyle:{color:\"red\"}},[t._v(t._s(e.row.reviewer))])]}}])}):t._e(),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.url\"),width:\"170px\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"span\",[t._v(t._s(e.row.url))])]}}])}),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.no\"),width:\"80px\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"span\",[t._v(t._s(e.row.no))])]}}])}),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.status\"),\"class-name\":\"status-col\",width:\"100\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"el-tag\",{attrs:{type:t._f(\"statusFilter\")(e.row.status)}},[t._v(t._s(e.row.status))])]}}])}),t._v(\" \"),i(\"el-table-column\",{attrs:{label:t.$t(\"table.actions\"),align:\"center\",width:\"230\",\"class-name\":\"small-padding fixed-width\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[i(\"el-button\",{attrs:{type:\"primary\",size:\"mini\"},on:{click:function(i){t.handleUpdate(e.row)}}},[t._v(t._s(t.$t(\"table.edit\")))]),t._v(\" \"),\"published\"!=e.row.status?i(\"el-button\",{attrs:{size:\"mini\",type:\"success\"},on:{click:function(i){t.handleModifyStatus(e.row,\"published\")}}},[t._v(t._s(t.$t(\"table.publish\")))]):t._e(),t._v(\" \"),\"hidden\"!=e.row.status?i(\"el-button\",{attrs:{size:\"mini\",type:\"danger\"},on:{click:function(i){t.handleModifyStatus(e.row,\"hidden\")}}},[t._v(t._s(t.$t(\"table.hidden\")))]):t._e(),t._v(\" \"),\"hidden\"==e.row.status?i(\"el-button\",{attrs:{size:\"mini\",type:\"warning\"},on:{click:function(i){t.handleDelete(e.row,\"hidden\")}}},[t._v(t._s(t.$t(\"table.delete\")))]):t._e()]}}])})],1),t._v(\" \"),i(\"el-dialog\",{staticStyle:{width:\"1400px\"},attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{\"update:visible\":function(e){t.dialogFormVisible=e}}},[i(\"el-form\",{ref:\"dataForm\",staticStyle:{width:\"400px\",\"margin-left\":\"50px\"},attrs:{rules:t.rules,model:t.temp,\"label-position\":\"left\",\"label-width\":\"70px\"}},[i(\"el-form-item\",{attrs:{label:t.$t(\"table.title\"),prop:\"title\"}},[i(\"el-input\",{model:{value:t.temp.title,callback:function(e){t.$set(t.temp,\"title\",e)},expression:\"temp.title\"}})],1),t._v(\" \"),i(\"el-form-item\",{attrs:{label:t.$t(\"table.status\")}},[i(\"el-select\",{staticClass:\"filter-item\",attrs:{placeholder:\"Please select\"},model:{value:t.temp.status,callback:function(e){t.$set(t.temp,\"status\",e)},expression:\"temp.status\"}},t._l(t.statusOptions,function(t){return i(\"el-option\",{key:t,attrs:{label:t,value:t}})}))],1),t._v(\" \"),i(\"el-form-item\",{attrs:{label:t.$t(\"table.no\"),prop:\"no\"}},[i(\"el-input-number\",{model:{value:t.temp.no,callback:function(e){t.$set(t.temp,\"no\",e)},expression:\"temp.no\"}})],1),t._v(\" \"),i(\"el-upload\",{ref:\"upload\",attrs:{action:\"\",\"http-request\":t.fnUploadRequest,\"show-file-list\":!0,limit:1,\"on-exceed\":t.beyondFile,\"on-success\":t.handleSuccess,\"before-upload\":t.beforeUpload}},[i(\"el-button\",{attrs:{size:\"small\",type:\"primary\"}},[t._v(\"上传图片\")])],1),t._v(\" \"),i(\"div\",[t._v(\"当前图片：\"+t._s(t.temp.image))])],1),t._v(\" \"),i(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[i(\"el-button\",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v(t._s(t.$t(\"table.cancel\")))]),t._v(\" \"),i(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){\"create\"===t.dialogStatus?t.createData():t.updateData()}}},[t._v(t._s(t.$t(\"table.confirm\")))])],1)],1),t._v(\" \"),i(\"el-dialog\",{attrs:{visible:t.dialogPvVisible,title:\"Reading statistics\"},on:{\"update:visible\":function(e){t.dialogPvVisible=e}}},[i(\"el-table\",{staticStyle:{width:\"100%\"},attrs:{data:t.pvData,border:\"\",fit:\"\",\"highlight-current-row\":\"\"}},[i(\"el-table-column\",{attrs:{prop:\"key\",label:\"Channel\"}}),t._v(\" \"),i(\"el-table-column\",{attrs:{prop:\"pv\",label:\"Pv\"}})],1),t._v(\" \"),i(\"span\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[i(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){t.dialogPvVisible=!1}}},[t._v(t._s(t.$t(\"table.confirm\")))])],1)],1)],1)},[],!1,null,null,null);_.options.__file=\"index.vue\";e.default=_.exports},Y5bG:function(t,e,i){\"use strict\";i.d(e,\"a\",function(){return n}),Math.easeInOutQuad=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e};var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function n(t,e,i){var n=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,s=t-n,l=0;e=void 0===e?500:e;!function t(){l+=20,function(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}(Math.easeInOutQuad(l,n,s,e)),l<e?a(t):i&&\"function\"==typeof i&&i()}()}},ZySA:function(t,e,i){\"use strict\";var a=i(\"P2sY\"),n=i.n(a),s=(i(\"jUE0\"),{bind:function(t,e){t.addEventListener(\"click\",function(i){var a=n()({},e.value),s=n()({ele:t,type:\"hit\",color:\"rgba(0, 0, 0, 0.15)\"},a),l=s.ele;if(l){l.style.position=\"relative\",l.style.overflow=\"hidden\";var o=l.getBoundingClientRect(),r=l.querySelector(\".waves-ripple\");switch(r?r.className=\"waves-ripple\":((r=document.createElement(\"span\")).className=\"waves-ripple\",r.style.height=r.style.width=Math.max(o.width,o.height)+\"px\",l.appendChild(r)),s.type){case\"center\":r.style.top=o.height/2-r.offsetHeight/2+\"px\",r.style.left=o.width/2-r.offsetWidth/2+\"px\";break;default:r.style.top=(i.pageY-o.top-r.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+\"px\",r.style.left=(i.pageX-o.left-r.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+\"px\"}return r.style.backgroundColor=s.color,r.className=\"waves-ripple z-active\",!1}},!1)}}),l=function(t){t.directive(\"waves\",s)};window.Vue&&(window.waves=s,Vue.use(l)),s.install=l;e.a=s},jUE0:function(t,e,i){}}]);","extractedComments":[]}